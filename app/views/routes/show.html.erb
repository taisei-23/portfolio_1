<div class="p-6">
  <h1 class="text-2xl font-bold mb-4">経路検索結果</h1>

  <p><strong>移動手段:</strong> <%= @transport == "car" ? "車" : "電車" %></p>
  <p><strong>出発:</strong> <%= @from %></p>
  <p><strong>目的地:</strong> <%= @to %></p>

  <div id="map" style="height: 500px;" class="my-6 border rounded shadow"></div>

  <div class="mt-6 border-t pt-4">
    <h2 class="text-xl font-semibold">テキスト情報</h2>
    <% if @route_data.present? %>
      <% @route_data.each_with_index do |route, index| %>
        <div class="mb-4 border-b pb-2">
          <h3 class="font-bold">ルート <%= index + 1 %>：<%= route[:summary] %></h3>
          <p><strong>距離:</strong> <%= route[:distance] %></p>
          <p><strong>所要時間:</strong> <%= route[:duration] %></p>
        </div>
      <% end %>
    <% else %>
      <p class="text-red-600">経路情報を取得できませんでした。</p>
    <% end %>
  </div>


  <script>
    function initMap() {
    const from = "<%= j @from %>";
    const to = "<%= j @to %>";
    const travelMode = "DRIVING";

    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: 7,
      center: { lat: 36.2048, lng: 138.2529 }
    });

    const directionsService = new google.maps.DirectionsService();
    const directionsRenderer = new google.maps.DirectionsRenderer({ map: map });

    directionsService.route({
      origin: from,
      destination: to,
      travelMode: google.maps.TravelMode[travelMode],
      provideRouteAlternatives: true,
    }, (response, status) => {
      if (status === "OK") {
        response.routes.forEach((route, index) => {
          const directionsRenderer = new google.maps.DirectionsRenderer({
            map: map,
            directions: response,
            routeIndex: index,
            polylineOptions: {
              strokeColor: getColor(index),
              strokeOpacity: 0.6,
              strokeWeight: 5,
            }
          });
        });
      } else {
        console.error("Directions API error in JS:", status);
        alert("経路を取得できませんでした: " + status);
      }
    });
    
    function getColor(index) {
      const colors = ["#4285F4", "#34A853", "#FBBC05", "#EA4335"];
      return colors[index % colors.length];
    }
  }

</script>

<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAPS_API_KEY'] %>&callback=initMap&libraries=places">
</script>