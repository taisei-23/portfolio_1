<div class="p-6">
  <h1 class="text-2xl font-bold mb-4">経路検索結果</h1>

  <p><strong>移動手段:</strong> <%= @transport == "car" ? "車" : "電車" %></p>
  <p><strong>出発:</strong> <%= @from %></p>
  <p><strong>目的地:</strong> <%= @to %></p>

  <div id="map" style="height: 500px;" class="my-6 border rounded shadow"></div>

  <div class="mt-6 border-t pt-4">
    <h2 class="text-xl font-semibold mb-2">テキスト情報</h2>

    <% if @route_data.present? %>
      <p><strong>距離:</strong> <%= @route_data[:distance] %></p>
      <p><strong>所要時間:</strong> <%= @route_data[:duration] %></p>
    <% else %>
      <p class="text-red-600">経路情報を取得できませんでした。</p>

      <% if @transport == "car" %>
        <p class="text-sm text-gray-600">車モードで失敗しました。</p>
      <% else %>
        <p class="text-sm text-gray-600">
          電車モードではルートが見つかりにくい場合があります。<br>
          駅名をより正式な表記（例: "新宿駅 東口" → "新宿駅"）に変えてみてください。
        </p>
      <% end %>
    <% end %>
  </div>
  <p>transport param: <%= @transport.inspect %></p>
</div>


  <script>
    function initMap() {
    const from = "<%= j @from %>";
    const to = "<%= j @to %>";
    const travelMode = "DRIVING";

    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: 7,
      center: { lat: 36.2048, lng: 138.2529 }
    });

    const directionsService = new google.maps.DirectionsService();
    const directionsRenderer = new google.maps.DirectionsRenderer({ map: map });

    directionsService.route({
      origin: from,
      destination: to,
      travelMode: google.maps.TravelMode[travelMode],
    }, (response, status) => {
      if (status === "OK") {
        directionsRenderer.setDirections(response);
      } else {
        console.error("Directions API error in JS:", status);
        alert("経路を取得できませんでした: " + status);
      }
    });
  }

</script>

<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAPS_API_KEY'] %>&callback=initMap&libraries=places">
</script>